  <!DOCTYPE html>
  <html>
  <head>
    <title>Recipe Box</title>
    <meta charset="UTF-8" http-equiv=”x-ua-compatible” content=”IE=edge” />
    <link rel="stylesheet" href="recipeCSS.css">
    <script src="https://unpkg.com/react@15/dist/react.min.js"></script>
    <script src="https://unpkg.com/react-dom@15/dist/react-dom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.24.0/babel.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.6/marked.min.js"></script>

  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">

function TableDataRows(props){
   console.log(props.data);
  return (
      <div className="main">
       {
         props.data.map((items,index)=>
         <div> <div className="recipe" onClick = { () => props.showIngredients(items.title)}>{items.title}</div>
           <div className="ingredients" id={items.title}>
            <b>Ingredients <br/><hr/> </b>
          {items.ingredients.map((item2, index)=>
                <div>  {item2}  </div>
            )

            }
            <button onClick = { () => props.removeRecipe(index)}>Delete</button>
            <button onClick = { () => props.editRecipe(index)}>Edit</button>
         </div></div>
        )
       }
  </div>

  )
}


class RecipeApp extends React.Component{
  constructor(props){
    super(props)
    this.state = {recipeName: "", ingredients: "", showPopup: false };

    var initRecipe = [{"title":"Curd Rice", "ingredients": ["Curd","Rice","Salt","Cumin seeds"]},
                      {"title":"Khichadi", "ingredients": ["Rice","Pulses","Salt","Ghee","Turmeric"]}
                     ];

    if(!localStorage.getItem("_ietrahul_recipe")) localStorage.setItem("_ietrahul_recipe",JSON.stringify(initRecipe));
    this.handleChange = this.handleChange.bind(this);
    this.handleSubmit = this.handleSubmit.bind(this);
    this.togglePopup = this.togglePopup.bind(this);
    this.showIngredients = this.showIngredients.bind(this);
    this.removeRecipe = this.removeRecipe.bind(this);
    this.editRecipe = this.editRecipe.bind(this);
  }

  togglePopup() {
    console.log("inside toggle");
    this.setState({showPopup: !this.state.showPopup});
    console.log("End toggle");
  }

  handleChange(event) {
    this.setState({[event.target.name]: event.target.value});
  }

  handleSubmit() {
    //console.log("start---")
    var  customData = JSON.parse(localStorage.getItem("_ietrahul_recipe"));
    var re = /\s*,\s*/
    customData.push({"title": this.state.recipeName, "ingredients": this.state.ingredients.split(re)});
    //console.log("2---"+customData)
    localStorage.setItem("_ietrahul_recipe",JSON.stringify(customData));
    event.preventDefault();
    //reset form data and close
    this.setState({recipeName: "", ingredients: "", showPopup: !this.state.showPopup});
  }

  showIngredients(idName){
    console.log("show here");
    const listmenu = document.getElementById(idName);
    listmenu.style.display = listmenu.style.display ==='block' ? 'none' : 'block';
  }

  removeRecipe(index){
    var  customDataCopy = JSON.parse(localStorage.getItem("_ietrahul_recipe"));
    customDataCopy.splice(index,1);
    customDataCopy.sort((a,b) => {
            return b.title < a.title
        })
    localStorage.setItem("_ietrahul_recipe",JSON.stringify(customDataCopy));
  }

  editRecipe(index){
    var  customDataCopy = JSON.parse(localStorage.getItem("_ietrahul_recipe"));
    this.setState({recipeName: customDataCopy[index].title, ingredients: customDataCopy[index].ingredients, showPopup: !this.state.showPopup});
  }

  render(){
    return (
    <div>
      <TableDataRows data={ JSON.parse(localStorage.getItem("_ietrahul_recipe")) }  showIngredients={this.showIngredients} removeRecipe={this.removeRecipe} editRecipe={this.editRecipe}/>
      <br/>
      <button onClick={this.togglePopup.bind(this)}> Add recipe </button>

       { this.state.showPopup && <div className='popup'>
        <div className='popup_inner'>
          <h1>Add Ingredients</h1>
         <button onClick={this.togglePopup}>X</button><br/>
        <form onSubmit={this.handleSubmit}>
        <label>
          Recipe Name: <input name="recipeName" type="text" value={this.state.recipeName} onChange={this.handleChange} />
        </label>
        <br/>
        <label>
          Ingredients: <textarea name="ingredients" value={this.state.ingredients} onChange={this.handleChange} />
        </label>
        <br/>
        <input type="submit" value="Submit" />
      </form>
       </div>
      </div>
      }
   </div>
    )
  }

}

  ReactDOM.render(
  <RecipeApp />,
  document.getElementById('root')
  );

  </script>
  </body>
  </html>
